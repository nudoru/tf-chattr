/*! app-framework 27-07-2015 */
define("APP.Application",function(a,b,c){function d(){var b,c;i=this,b=this.createApplicationModel(a("APP.Model.AppModel")),c=this.createApplicationView(a("APP.View.AppView")),this.initializeApplication({model:b,view:c}),l.subscribe(k.PUBLISH_MESSAGE,e),l.subscribe(k.NICK_UPDATE,g),this.view().initialize(),this.model().initialize(),this.view().removeLoadingMessage(),this.setCurrentRoute(APP.router().getCurrentRoute()),this.view().render(),j=io(),j.on("message",f),j.on("userupdate",h)}function e(a){console.log("controller, handleMessagePublished, socket EMITTING"),j.emit("message",{username:a.payload.username,message:a.payload.message})}function f(a){console.log("controller handleMessageRecieved:",a),i.model().addMessage(a.username,a.message)}function g(a){j.emit("nickchange",a.payload.nick)}function h(a){console.log("server user: ",a),i.model().setUsers(a)}var i,j,k=a("App.Events.EventConstants"),l=(a("App.Events.EventCreator"),a("Nori.Utils.Dispatcher"));c.initialize=d}),define("App.Events.EventConstants",function(a,b,c){var d=a("Nudoru.Core.ObjectUtils");_.merge(c,d.keyMirror({PUBLISH_MESSAGE:null,NICK_UPDATE:null}))}),define("App.Events.EventCreator",function(a,b,c){var d=a("Nori.Utils.Dispatcher"),e=a("App.Events.EventConstants");c.publishMessage=function(a,b){d.publish({type:e.PUBLISH_MESSAGE,payload:{username:a,message:b}})},c.updateNick=function(a){d.publish({type:e.NICK_UPDATE,payload:{nick:a}})}}),define("APP.Model.AppModel",function(a,b,c){function d(){m=this,t.subscribe(s.PUBLISH_MESSAGE,k),t.subscribe(s.NICK_UPDATE,l),o=m.createMapCollection({id:"UsersCollection"}),p=m.createMapCollection({id:"MessagesCollection"}),q.applicationModelInitialized()}function e(){return o}function f(){return p}function g(a){o.removeAll(),a.forEach(function(a){h(a)})}function h(a){a&&o.add(m.createMap({id:a,store:{username:a}}))}function i(a){o.remove(a)}function j(a,b){console.log("model, addMessage"),a=a||"Unknown",p.add(m.createMap({id:r++,store:{username:a,content:b}}))}function k(a){console.log("model, handleMessagePublished"),j(a.payload.username,a.payload.message)}function l(a){console.log("nick change:",a.payload),n=a.payload.nick}var m,n,o,p,q=a("Nori.Events.AppEventCreator"),r=1,s=a("App.Events.EventConstants"),t=a("Nori.Utils.Dispatcher");c.initialize=d,c.getUsersCollection=e,c.getMessagesCollection=f,c.setUsers=g,c.addUser=h,c.removeUser=i,c.addMessage=j}),define("APP.View.AppSubView",function(a,b,c){function d(a){this.isInitialized()||this.initializeSubView(a)}function e(){}c.initialize=d,c.viewWillUpdate=e}),define("APP.View.AppView",function(a,b,c){function d(){l=this,l.initializeApplicationView(["applicationscaffold","applicationcomponentsscaffold"]),l.setRouteViewMountPoint("#contents"),k(),APP.mapRouteView("/","default","APP.View.AppSubView"),m.applicationViewInitialized()}function e(){l.setEvents({"change #nick-input":f,"change #message-input":g}),l.delegateEvents(),l.createComponent("user-list","APP.View.UserList","#users"),l.createComponent("message-list","APP.View.MessageList","#message"),l.renderComponent("user-list"),l.renderComponent("message-list")}function f(a){p.updateNick(a.target.value)}function g(){p.publishMessage(h(),i()),j()}function h(){return document.getElementById("nick-input").value}function i(){return document.getElementById("message-input").value}function j(){return document.getElementById("message-input").value=""}function k(){n.subscribe(o.NOTIFY_USER,function(a){l.notify(a.payload.message,a.payload.title,a.payload.type)}),n.subscribe(o.ALERT_USER,function(a){l.alert(a.payload.message,a.payload.title)})}{var l,m=a("Nori.Events.AppEventCreator"),n=a("Nori.Utils.Dispatcher"),o=a("Nori.Events.AppEventConstants"),m=a("Nori.Events.AppEventCreator"),p=a("App.Events.EventCreator");a("Nudoru.Browser.BrowserEventConstants")}c.initialize=d,c.render=e}),define("APP.View.MessageList",function(a,b,c){function d(a){this.isInitialized()||(g=this,this.initializeSubView(a),APP.registerViewForModelChanges("MessagesCollection",this.getID()))}function e(){var a=Object.create(null);a.messages=[],APP.model().getMessagesCollection().forEach(function(b){a.messages.push({username:b.get("username"),content:b.get("content")})}),g.setState(a)}function f(){var a=g.getDOMElement().parentNode;a.scrollTop=a.scrollHeight}var g;c.initialize=d,c.viewWillUpdate=e,c.viewDidMount=f}),define("APP.View.UserList",function(a,b,c){function d(a){this.isInitialized()||(f=this,this.initializeSubView(a),APP.registerViewForModelChanges("UsersCollection",this.getID()))}function e(){var a=Object.create(null);a.users=[],APP.model().getUsersCollection().forEach(function(b){a.users.push(b.get("username"))}),f.setState(a)}var f;c.initialize=d,c.viewWillUpdate=e}),function(){var a=require("Nudoru.Browser.BrowserInfo");a.notSupported||a.isIE9?document.querySelector("body").innerHTML="<h3>For the best experience, please use Internet Explorer 10+, Firefox, Chrome or Safari to view this application.</h3>":window.onload=function(){window.APP=Nori.createApplication(require("APP.Application")),APP.initialize()}}();